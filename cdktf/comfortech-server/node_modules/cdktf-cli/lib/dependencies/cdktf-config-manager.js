"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.CdktfConfigManager = void 0;
const cdktf_config_1 = require("../cdktf-config");
const dependency_manager_1 = require("./dependency-manager");
/**
 * facilitates adding provider dependencies to cdktf.json
 */
class CdktfConfigManager {
    constructor() {
        this.config = cdktf_config_1.CdktfConfig.read();
    }
    async hasProvider(constraint) {
        return this.config.terraformProviders.some((provider) => dependency_manager_1.ProviderConstraint.fromConfigEntry(provider).source ===
            constraint.source);
    }
    async addProvider(constraint) {
        // excluding the constraint to be added (if it already existed)
        const currentProviders = this.config.terraformProviders.filter((provider) => dependency_manager_1.ProviderConstraint.fromConfigEntry(provider).source !==
            constraint.source);
        const simplifiedSource = constraint.source.replace("registry.terraform.io/", "");
        const provider = simplifiedSource + (constraint.version ? `@${constraint.version}` : "");
        currentProviders.push(provider);
        this.config.writeTerraformProviders(currentProviders);
    }
}
exports.CdktfConfigManager = CdktfConfigManager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrdGYtY29uZmlnLW1hbmFnZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjZGt0Zi1jb25maWctbWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxrREFBOEM7QUFDOUMsNkRBQTBEO0FBRTFEOztHQUVHO0FBQ0gsTUFBYSxrQkFBa0I7SUFBL0I7UUFDVSxXQUFNLEdBQWdCLDBCQUFXLENBQUMsSUFBSSxFQUFFLENBQUM7SUE2Qm5ELENBQUM7SUEzQlEsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUE4QjtRQUNyRCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUN4QyxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQ1gsdUNBQWtCLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU07WUFDbkQsVUFBVSxDQUFDLE1BQU0sQ0FDcEIsQ0FBQztJQUNKLENBQUM7SUFFTSxLQUFLLENBQUMsV0FBVyxDQUFDLFVBQThCO1FBQ3JELCtEQUErRDtRQUMvRCxNQUFNLGdCQUFnQixHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUM1RCxDQUFDLFFBQVEsRUFBRSxFQUFFLENBQ1gsdUNBQWtCLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU07WUFDbkQsVUFBVSxDQUFDLE1BQU0sQ0FDcEIsQ0FBQztRQUVGLE1BQU0sZ0JBQWdCLEdBQUcsVUFBVSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQ2hELHdCQUF3QixFQUN4QixFQUFFLENBQ0gsQ0FBQztRQUVGLE1BQU0sUUFBUSxHQUNaLGdCQUFnQixHQUFHLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRTFFLGdCQUFnQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsTUFBTSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDeEQsQ0FBQztDQUNGO0FBOUJELGdEQThCQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENka3RmQ29uZmlnIH0gZnJvbSBcIi4uL2Nka3RmLWNvbmZpZ1wiO1xuaW1wb3J0IHsgUHJvdmlkZXJDb25zdHJhaW50IH0gZnJvbSBcIi4vZGVwZW5kZW5jeS1tYW5hZ2VyXCI7XG5cbi8qKlxuICogZmFjaWxpdGF0ZXMgYWRkaW5nIHByb3ZpZGVyIGRlcGVuZGVuY2llcyB0byBjZGt0Zi5qc29uXG4gKi9cbmV4cG9ydCBjbGFzcyBDZGt0ZkNvbmZpZ01hbmFnZXIge1xuICBwcml2YXRlIGNvbmZpZzogQ2RrdGZDb25maWcgPSBDZGt0ZkNvbmZpZy5yZWFkKCk7XG5cbiAgcHVibGljIGFzeW5jIGhhc1Byb3ZpZGVyKGNvbnN0cmFpbnQ6IFByb3ZpZGVyQ29uc3RyYWludCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy50ZXJyYWZvcm1Qcm92aWRlcnMuc29tZShcbiAgICAgIChwcm92aWRlcikgPT5cbiAgICAgICAgUHJvdmlkZXJDb25zdHJhaW50LmZyb21Db25maWdFbnRyeShwcm92aWRlcikuc291cmNlID09PVxuICAgICAgICBjb25zdHJhaW50LnNvdXJjZVxuICAgICk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgYWRkUHJvdmlkZXIoY29uc3RyYWludDogUHJvdmlkZXJDb25zdHJhaW50KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gZXhjbHVkaW5nIHRoZSBjb25zdHJhaW50IHRvIGJlIGFkZGVkIChpZiBpdCBhbHJlYWR5IGV4aXN0ZWQpXG4gICAgY29uc3QgY3VycmVudFByb3ZpZGVycyA9IHRoaXMuY29uZmlnLnRlcnJhZm9ybVByb3ZpZGVycy5maWx0ZXIoXG4gICAgICAocHJvdmlkZXIpID0+XG4gICAgICAgIFByb3ZpZGVyQ29uc3RyYWludC5mcm9tQ29uZmlnRW50cnkocHJvdmlkZXIpLnNvdXJjZSAhPT1cbiAgICAgICAgY29uc3RyYWludC5zb3VyY2VcbiAgICApO1xuXG4gICAgY29uc3Qgc2ltcGxpZmllZFNvdXJjZSA9IGNvbnN0cmFpbnQuc291cmNlLnJlcGxhY2UoXG4gICAgICBcInJlZ2lzdHJ5LnRlcnJhZm9ybS5pby9cIixcbiAgICAgIFwiXCJcbiAgICApO1xuXG4gICAgY29uc3QgcHJvdmlkZXIgPVxuICAgICAgc2ltcGxpZmllZFNvdXJjZSArIChjb25zdHJhaW50LnZlcnNpb24gPyBgQCR7Y29uc3RyYWludC52ZXJzaW9ufWAgOiBcIlwiKTtcblxuICAgIGN1cnJlbnRQcm92aWRlcnMucHVzaChwcm92aWRlcik7XG4gICAgdGhpcy5jb25maWcud3JpdGVUZXJyYWZvcm1Qcm92aWRlcnMoY3VycmVudFByb3ZpZGVycyk7XG4gIH1cbn1cbiJdfQ==