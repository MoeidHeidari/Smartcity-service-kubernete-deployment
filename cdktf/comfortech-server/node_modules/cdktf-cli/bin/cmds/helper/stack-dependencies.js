"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.StackDependencies = void 0;
class StackDependencies {
    constructor(stacks) {
        this.stacks = stacks;
        this.pendingStacks = [];
        this.inflightStacks = [];
        this.deployedStacks = [];
        this.pendingStacks = [...this.stacks];
    }
    startRun(stack) {
        this.pendingStacks = this.pendingStacks.filter((item) => item.name !== stack.name);
        this.inflightStacks.push(stack);
    }
    finishRun(stack) {
        this.inflightStacks = this.inflightStacks.filter((item) => item.name !== stack.name);
        this.deployedStacks.push(stack);
    }
    get pendingDeployableStacks() {
        return this.pendingStacks.filter((pendingStack) => {
            const unmetDependencies = pendingStack.dependencies.filter((dependency) => {
                return !this.deployedStacks.some((deployedStack) => {
                    return deployedStack.name === dependency;
                });
            });
            return unmetDependencies.length === 0;
        });
    }
}
exports.StackDependencies = StackDependencies;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhY2stZGVwZW5kZW5jaWVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsic3RhY2stZGVwZW5kZW5jaWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUVBLE1BQWEsaUJBQWlCO0lBSzVCLFlBQTZCLE1BQTBCO1FBQTFCLFdBQU0sR0FBTixNQUFNLENBQW9CO1FBSmhELGtCQUFhLEdBQXVCLEVBQUUsQ0FBQztRQUN2QyxtQkFBYyxHQUF1QixFQUFFLENBQUM7UUFDeEMsbUJBQWMsR0FBdUIsRUFBRSxDQUFDO1FBRzdDLElBQUksQ0FBQyxhQUFhLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN4QyxDQUFDO0lBRU0sUUFBUSxDQUFDLEtBQXVCO1FBQ3JDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQzVDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQ25DLENBQUM7UUFDRixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRU0sU0FBUyxDQUFDLEtBQXVCO1FBQ3RDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQzlDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQ25DLENBQUM7UUFDRixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBRUQsSUFBVyx1QkFBdUI7UUFDaEMsT0FBTyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksRUFBRSxFQUFFO1lBQ2hELE1BQU0saUJBQWlCLEdBQUcsWUFBWSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQ3hELENBQUMsVUFBVSxFQUFFLEVBQUU7Z0JBQ2IsT0FBTyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxFQUFFLEVBQUU7b0JBQ2pELE9BQU8sYUFBYSxDQUFDLElBQUksS0FBSyxVQUFVLENBQUM7Z0JBQzNDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUNGLENBQUM7WUFFRixPQUFPLGlCQUFpQixDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7UUFDeEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUFwQ0QsOENBb0NDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3ludGhlc2l6ZWRTdGFjayB9IGZyb20gXCIuLi8uLi8uLi9saWIvc3ludGgtc3RhY2tcIjtcblxuZXhwb3J0IGNsYXNzIFN0YWNrRGVwZW5kZW5jaWVzIHtcbiAgcHVibGljIHBlbmRpbmdTdGFja3M6IFN5bnRoZXNpemVkU3RhY2tbXSA9IFtdO1xuICBwdWJsaWMgaW5mbGlnaHRTdGFja3M6IFN5bnRoZXNpemVkU3RhY2tbXSA9IFtdO1xuICBwdWJsaWMgZGVwbG95ZWRTdGFja3M6IFN5bnRoZXNpemVkU3RhY2tbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgc3RhY2tzOiBTeW50aGVzaXplZFN0YWNrW10pIHtcbiAgICB0aGlzLnBlbmRpbmdTdGFja3MgPSBbLi4udGhpcy5zdGFja3NdO1xuICB9XG5cbiAgcHVibGljIHN0YXJ0UnVuKHN0YWNrOiBTeW50aGVzaXplZFN0YWNrKTogdm9pZCB7XG4gICAgdGhpcy5wZW5kaW5nU3RhY2tzID0gdGhpcy5wZW5kaW5nU3RhY2tzLmZpbHRlcihcbiAgICAgIChpdGVtKSA9PiBpdGVtLm5hbWUgIT09IHN0YWNrLm5hbWVcbiAgICApO1xuICAgIHRoaXMuaW5mbGlnaHRTdGFja3MucHVzaChzdGFjayk7XG4gIH1cblxuICBwdWJsaWMgZmluaXNoUnVuKHN0YWNrOiBTeW50aGVzaXplZFN0YWNrKTogdm9pZCB7XG4gICAgdGhpcy5pbmZsaWdodFN0YWNrcyA9IHRoaXMuaW5mbGlnaHRTdGFja3MuZmlsdGVyKFxuICAgICAgKGl0ZW0pID0+IGl0ZW0ubmFtZSAhPT0gc3RhY2submFtZVxuICAgICk7XG4gICAgdGhpcy5kZXBsb3llZFN0YWNrcy5wdXNoKHN0YWNrKTtcbiAgfVxuXG4gIHB1YmxpYyBnZXQgcGVuZGluZ0RlcGxveWFibGVTdGFja3MoKTogU3ludGhlc2l6ZWRTdGFja1tdIHtcbiAgICByZXR1cm4gdGhpcy5wZW5kaW5nU3RhY2tzLmZpbHRlcigocGVuZGluZ1N0YWNrKSA9PiB7XG4gICAgICBjb25zdCB1bm1ldERlcGVuZGVuY2llcyA9IHBlbmRpbmdTdGFjay5kZXBlbmRlbmNpZXMuZmlsdGVyKFxuICAgICAgICAoZGVwZW5kZW5jeSkgPT4ge1xuICAgICAgICAgIHJldHVybiAhdGhpcy5kZXBsb3llZFN0YWNrcy5zb21lKChkZXBsb3llZFN0YWNrKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZGVwbG95ZWRTdGFjay5uYW1lID09PSBkZXBlbmRlbmN5O1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gdW5tZXREZXBlbmRlbmNpZXMubGVuZ3RoID09PSAwO1xuICAgIH0pO1xuICB9XG59XG4iXX0=