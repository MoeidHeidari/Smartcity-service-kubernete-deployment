"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
const fs = __importStar(require("fs"));
const os = __importStar(require("os"));
const path = __importStar(require("path"));
const constructs_maker_1 = require("../../constructs-maker");
jest.setTimeout(600000);
test("generates a versions file", async () => {
    const workdir = await fs.mkdtempSync(path.join(os.tmpdir(), "versions-file.test"));
    const options = {
        codeMakerOutput: workdir,
        targetLanguage: constructs_maker_1.Language.TYPESCRIPT,
    };
    const constraints = [
        {
            fqn: "hashicorp/aws",
            name: "aws",
            source: "hashicorp/aws",
            version: "4.0.0",
        },
        {
            fqn: "hashicorp/random",
            name: "random",
            source: "hashicorp/random",
            version: "3.1.3",
        },
        {
            fqn: "kreuzwerker/docker",
            name: "docker",
            source: "kreuzwerker/docker",
            version: "2.16.0",
        },
    ];
    const constructMaker = new constructs_maker_1.ConstructsMaker(options, constraints);
    await constructMaker.generate();
    const output = fs.readFileSync(path.join(workdir, "versions.json"), "utf-8");
    expect(Object.keys(JSON.parse(output))).toEqual(expect.arrayContaining(constraints.map((c) => `registry.terraform.io/${c.fqn}`)));
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVyc2lvbnMtZmlsZS50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidmVyc2lvbnMtZmlsZS50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLHVDQUF5QjtBQUN6Qix1Q0FBeUI7QUFDekIsMkNBQTZCO0FBRTdCLDZEQUErRTtBQUUvRSxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU8sQ0FBQyxDQUFDO0FBRXpCLElBQUksQ0FBQywyQkFBMkIsRUFBRSxLQUFLLElBQUksRUFBRTtJQUMzQyxNQUFNLE9BQU8sR0FBRyxNQUFNLEVBQUUsQ0FBQyxXQUFXLENBQ2xDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxFQUFFLG9CQUFvQixDQUFDLENBQzdDLENBQUM7SUFFRixNQUFNLE9BQU8sR0FBZTtRQUMxQixlQUFlLEVBQUUsT0FBTztRQUN4QixjQUFjLEVBQUUsMkJBQVEsQ0FBQyxVQUFVO0tBQ3BDLENBQUM7SUFDRixNQUFNLFdBQVcsR0FBb0M7UUFDbkQ7WUFDRSxHQUFHLEVBQUUsZUFBZTtZQUNwQixJQUFJLEVBQUUsS0FBSztZQUNYLE1BQU0sRUFBRSxlQUFlO1lBQ3ZCLE9BQU8sRUFBRSxPQUFPO1NBQ2pCO1FBQ0Q7WUFDRSxHQUFHLEVBQUUsa0JBQWtCO1lBQ3ZCLElBQUksRUFBRSxRQUFRO1lBQ2QsTUFBTSxFQUFFLGtCQUFrQjtZQUMxQixPQUFPLEVBQUUsT0FBTztTQUNqQjtRQUNEO1lBQ0UsR0FBRyxFQUFFLG9CQUFvQjtZQUN6QixJQUFJLEVBQUUsUUFBUTtZQUNkLE1BQU0sRUFBRSxvQkFBb0I7WUFDNUIsT0FBTyxFQUFFLFFBQVE7U0FDbEI7S0FDRixDQUFDO0lBQ0YsTUFBTSxjQUFjLEdBQUcsSUFBSSxrQ0FBZSxDQUFDLE9BQU8sRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNqRSxNQUFNLGNBQWMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUVoQyxNQUFNLE1BQU0sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLGVBQWUsQ0FBQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzdFLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDN0MsTUFBTSxDQUFDLGVBQWUsQ0FDcEIsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMseUJBQXlCLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUN6RCxDQUNGLENBQUM7QUFDSixDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0ICogYXMgb3MgZnJvbSBcIm9zXCI7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gXCJwYXRoXCI7XG5pbXBvcnQgeyBUZXJyYWZvcm1EZXBlbmRlbmN5Q29uc3RyYWludCB9IGZyb20gXCIuLi8uLi8uLi9jb25maWdcIjtcbmltcG9ydCB7IENvbnN0cnVjdHNNYWtlciwgTGFuZ3VhZ2UsIEdldE9wdGlvbnMgfSBmcm9tIFwiLi4vLi4vY29uc3RydWN0cy1tYWtlclwiO1xuXG5qZXN0LnNldFRpbWVvdXQoNjAwXzAwMCk7XG5cbnRlc3QoXCJnZW5lcmF0ZXMgYSB2ZXJzaW9ucyBmaWxlXCIsIGFzeW5jICgpID0+IHtcbiAgY29uc3Qgd29ya2RpciA9IGF3YWl0IGZzLm1rZHRlbXBTeW5jKFxuICAgIHBhdGguam9pbihvcy50bXBkaXIoKSwgXCJ2ZXJzaW9ucy1maWxlLnRlc3RcIilcbiAgKTtcblxuICBjb25zdCBvcHRpb25zOiBHZXRPcHRpb25zID0ge1xuICAgIGNvZGVNYWtlck91dHB1dDogd29ya2RpcixcbiAgICB0YXJnZXRMYW5ndWFnZTogTGFuZ3VhZ2UuVFlQRVNDUklQVCxcbiAgfTtcbiAgY29uc3QgY29uc3RyYWludHM6IFRlcnJhZm9ybURlcGVuZGVuY3lDb25zdHJhaW50W10gPSBbXG4gICAge1xuICAgICAgZnFuOiBcImhhc2hpY29ycC9hd3NcIixcbiAgICAgIG5hbWU6IFwiYXdzXCIsXG4gICAgICBzb3VyY2U6IFwiaGFzaGljb3JwL2F3c1wiLFxuICAgICAgdmVyc2lvbjogXCI0LjAuMFwiLFxuICAgIH0sXG4gICAge1xuICAgICAgZnFuOiBcImhhc2hpY29ycC9yYW5kb21cIixcbiAgICAgIG5hbWU6IFwicmFuZG9tXCIsXG4gICAgICBzb3VyY2U6IFwiaGFzaGljb3JwL3JhbmRvbVwiLFxuICAgICAgdmVyc2lvbjogXCIzLjEuM1wiLFxuICAgIH0sXG4gICAge1xuICAgICAgZnFuOiBcImtyZXV6d2Vya2VyL2RvY2tlclwiLFxuICAgICAgbmFtZTogXCJkb2NrZXJcIixcbiAgICAgIHNvdXJjZTogXCJrcmV1endlcmtlci9kb2NrZXJcIixcbiAgICAgIHZlcnNpb246IFwiMi4xNi4wXCIsXG4gICAgfSxcbiAgXTtcbiAgY29uc3QgY29uc3RydWN0TWFrZXIgPSBuZXcgQ29uc3RydWN0c01ha2VyKG9wdGlvbnMsIGNvbnN0cmFpbnRzKTtcbiAgYXdhaXQgY29uc3RydWN0TWFrZXIuZ2VuZXJhdGUoKTtcblxuICBjb25zdCBvdXRwdXQgPSBmcy5yZWFkRmlsZVN5bmMocGF0aC5qb2luKHdvcmtkaXIsIFwidmVyc2lvbnMuanNvblwiKSwgXCJ1dGYtOFwiKTtcbiAgZXhwZWN0KE9iamVjdC5rZXlzKEpTT04ucGFyc2Uob3V0cHV0KSkpLnRvRXF1YWwoXG4gICAgZXhwZWN0LmFycmF5Q29udGFpbmluZyhcbiAgICAgIGNvbnN0cmFpbnRzLm1hcCgoYykgPT4gYHJlZ2lzdHJ5LnRlcnJhZm9ybS5pby8ke2MuZnFufWApXG4gICAgKVxuICApO1xufSk7XG4iXX0=